{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nvar _jsxFileName = \"/Users/daiwei/pr/react-website-next/components/Audio/index.tsx\";\nvar __jsx = React.createElement;\nimport React, { useState, useRef, useImperativeHandle, useMemo, useEffect } from 'react';\nimport cls from 'classnames';\nimport './audio.less';\nimport NextIcon from './next.svg';\nimport PauseIcon from './pause.svg';\nimport PlayIcon from './play.svg';\nimport { throttle } from './utils';\nvar DEFAULT_PLAY_INFO = {\n  name: 'sunmmer',\n  disc: 'hollo sunmmer',\n  url: 'https://www.daiwei.site/static/music/background.mp3',\n  coverUrl: 'https://www.daiwei.site/static/logo/sunmmer.jpg'\n};\n\nvar Daudio = function Daudio(_ref, ref) {\n  var _cls2, _cls5;\n\n  var _ref$style = _ref.style,\n      style = _ref$style === void 0 ? 'circle' : _ref$style,\n      _ref$type = _ref.type,\n      type = _ref$type === void 0 ? 'handle' : _ref$type,\n      _ref$playType = _ref.playType,\n      playType = _ref$playType === void 0 ? 'sequential-play' : _ref$playType,\n      _ref$playList = _ref.playList,\n      playList = _ref$playList === void 0 ? [DEFAULT_PLAY_INFO] : _ref$playList;\n\n  var _useState = useState(false),\n      playing = _useState[0],\n      setPlaying = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(0),\n      progress = _useState3[0],\n      setProgress = _useState3[1];\n\n  var _useState4 = useState(style),\n      audioStyle = _useState4[0],\n      setAudioStyle = _useState4[1];\n\n  var _useState5 = useState(playType),\n      playTypeState = _useState5[0],\n      setPlayTypeState = _useState5[1];\n\n  var _useState6 = useState(type),\n      audioTypeState = _useState6[0],\n      setAudioTypeState = _useState6[1];\n\n  var eventQueue = useRef(null);\n\n  var _useState7 = useState(0),\n      playIndex = _useState7[0],\n      setPlayIndex = _useState7[1];\n\n  var _useState8 = useState(playList),\n      playQueue = _useState8[0],\n      setPlayQueue = _useState8[1];\n\n  var _useState9 = useState(true),\n      muted = _useState9[0],\n      setMuted = _useState9[1];\n\n  var audioRef = useRef(null);\n  var isHandle = useMemo(function () {\n    return audioTypeState === 'handle';\n  }, [audioTypeState]);\n  var currentPlayList = useMemo(function () {\n    return audioTypeState === 'handle' ? playQueue[0] : playQueue[playIndex];\n  }, [playIndex, playQueue[0]]);\n  var isLoop = useMemo(function () {\n    return playTypeState === 'loop-play';\n  }, [playTypeState]);\n\n  var checkAudioType = function checkAudioType() {\n    if (audioStyle === 'rect') {\n      setAudioStyle(function (audioStyle) {\n        return audioStyle = 'circle';\n      });\n    } else {\n      setAudioStyle(function (audioStyle) {\n        return audioStyle = 'rect';\n      });\n    }\n  };\n\n  useEffect(function () {\n    audioRef.current.addEventListener('timeupdate', onAudioTimeUpdate);\n    return function () {\n      audioRef.current.removeEventListener('timeupdate', onAudioTimeUpdate);\n    };\n  }, []);\n\n  var setStyle = function setStyle(t) {\n    setAudioStyle(t);\n  };\n\n  var handlePlayPause = function handlePlayPause(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    playing ? pause() : play();\n  };\n\n  var pause = function pause() {\n    var _audioRef$current;\n\n    (_audioRef$current = audioRef.current) === null || _audioRef$current === void 0 ? void 0 : _audioRef$current.pause();\n    setPlaying(false);\n  };\n\n  var play = function play() {\n    var _audioRef$current2;\n\n    (_audioRef$current2 = audioRef.current) === null || _audioRef$current2 === void 0 ? void 0 : _audioRef$current2.play();\n    setPlaying(true);\n  };\n\n  var next = function next(e) {\n    e.stopPropagation();\n    e.preventDefault(); // setHandleList(audioInfo)\n\n    if (isHandle) {\n      var _eventHandler$onNext;\n\n      console.log('by-handle'); // next事件\n\n      var eventHandler = eventQueue.current;\n      eventHandler === null || eventHandler === void 0 ? void 0 : (_eventHandler$onNext = eventHandler.onNext) === null || _eventHandler$onNext === void 0 ? void 0 : _eventHandler$onNext.map(function (item) {\n        return item.call(null);\n      });\n      return;\n    }\n\n    checkNextByList();\n  };\n\n  var setAudioType = function setAudioType(t) {\n    setAudioTypeState(t);\n  };\n\n  var playByIndex = function playByIndex(index) {\n    setPlayIndex(index);\n    play();\n  };\n  /**\n   * 列表切换下一首\n   */\n\n\n  var checkNextByList = function checkNextByList() {\n    console.log('by-list');\n    console.log(playQueue);\n    var l = playQueue.length;\n\n    if (l === 1) {\n      load();\n      play();\n      return;\n    } // 随机\n\n\n    if (playType === 'random-play') {\n      playByIndex(~~(Math.random() * playQueue.length));\n    } else {\n      // 列表\n      console.log('playIndexplayIndex', playIndex);\n      var index = playIndex >= l - 1 ? 0 : playIndex + 1;\n      playByIndex(index);\n    }\n  };\n  /**\n   * type 为 handle 时可调用\n   * @param nextAudio 切换下一首 \n   */\n\n\n  var cut = function cut(nextAudio) {\n    console.log(isHandle);\n\n    if (!isHandle) {\n      throw Error(\"The \\u3010cut\\u3011 method can only be executed when the type is handle\");\n    }\n\n    load();\n    setPlayQueue([nextAudio]);\n    play();\n  };\n\n  var setPlayList = function setPlayList(list) {\n    setPlayQueue(list);\n  };\n\n  var setPlayType = function setPlayType(t) {\n    setPlayTypeState(t);\n  };\n\n  var start = function start() {};\n\n  var ended = function ended() {\n    console.log(eventQueue);\n    console.log('ended');\n  };\n\n  var load = function load() {\n    var _audioRef$current3;\n\n    (_audioRef$current3 = audioRef.current) === null || _audioRef$current3 === void 0 ? void 0 : _audioRef$current3.load();\n  };\n\n  var onAudioPlay = function onAudioPlay() {\n    if (muted) {\n      setMuted(false);\n    } // other fn\n\n  };\n  /**\n   * 添加事件\n   */\n\n\n  var addEvent = function addEvent(name, fn) {\n    var obj = {};\n    var eventHandler = eventQueue.current;\n    obj[name] = eventHandler && eventHandler[name] && eventHandler[name].length ? [].concat(_toConsumableArray(eventHandler[name]), [fn]) : [fn];\n    eventQueue.current = Object.assign({}, eventHandler, obj);\n  };\n\n  var url = currentPlayList.url,\n      coverUrl = currentPlayList.coverUrl,\n      name = currentPlayList.name,\n      disc = currentPlayList.disc;\n  console.log(currentPlayList);\n  var mainClass = cls(_defineProperty({}, \"d-audio\", true));\n  var classWrapper = cls((_cls2 = {}, _defineProperty(_cls2, mainClass, true), _defineProperty(_cls2, audioStyle, true), _defineProperty(_cls2, \"show\", true), _cls2));\n  var classCricle = cls(_defineProperty({}, \"d-audio-circle\", true));\n  var classPlayPause = cls(_defineProperty({}, \"d-audio-play-pause\", true));\n  var classLoading = cls((_cls5 = {}, _defineProperty(_cls5, \"d-audio-loading\", true), _defineProperty(_cls5, \"active\", loading), _cls5));\n  var blurStyle = {\n    backgroundImage: \"url(\".concat(coverUrl, \")\"),\n    backgroundSize: 'cover',\n    backgroundPosition: 'center center'\n  };\n  var rangeStyle = {\n    border: \"3px solid red\"\n  };\n  var progressStyle = {\n    backgroundImage: \"linear-gradient(to right, red 30%, blue)\",\n    width: \"\".concat(progress, \"%\")\n  };\n  var onAudioTimeUpdate = throttle(function (e) {\n    var _audioRef$current4, _audioRef$current5;\n\n    setProgress(~~((((_audioRef$current4 = audioRef.current) === null || _audioRef$current4 === void 0 ? void 0 : _audioRef$current4.currentTime) || 0) / (((_audioRef$current5 = audioRef.current) === null || _audioRef$current5 === void 0 ? void 0 : _audioRef$current5.duration) || 1) * 100));\n  }, 1000);\n\n  var renderCricle = function renderCricle() {\n    return __jsx(\"div\", {\n      className: classCricle,\n      title: \"\".concat(name, \" - \").concat(disc),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322\n      },\n      __self: this\n    }, __jsx(\"img\", {\n      className: \"\".concat(classCricle),\n      crossOrigin: \"anonymous\",\n      src: coverUrl,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324\n      },\n      __self: this\n    }), __jsx(\"div\", {\n      className: \"\".concat(classCricle, \"-range\"),\n      style: rangeStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 325\n      },\n      __self: this\n    }));\n  };\n\n  useImperativeHandle(ref, function () {\n    return {\n      start: start,\n      next: next,\n      play: play,\n      pause: pause,\n      addEvent: addEvent,\n      setStyle: setStyle,\n      cut: cut,\n      setAudioType: setAudioType,\n      setPlayList: setPlayList,\n      setPlayType: setPlayType\n    };\n  });\n\n  var renderRect = function renderRect() {\n    return __jsx(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344\n      },\n      __self: this\n    }, __jsx(\"div\", {\n      className: \"\".concat(mainClass, \"-detail\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 345\n      },\n      __self: this\n    }, __jsx(\"div\", {\n      className: \"\".concat(mainClass, \"-detail-config\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 346\n      },\n      __self: this\n    }, __jsx(\"div\", {\n      className: classPlayPause,\n      onClick: handlePlayPause,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 347\n      },\n      __self: this\n    }, playing ? __jsx(PauseIcon, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350\n      },\n      __self: this\n    }) : __jsx(PlayIcon, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 352\n      },\n      __self: this\n    })), __jsx(\"div\", {\n      className: \"d-audio-next\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356\n      },\n      __self: this\n    }, __jsx(NextIcon, {\n      onClick: next,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357\n      },\n      __self: this\n    }))), __jsx(\"div\", {\n      className: \"\".concat(mainClass, \"-detail-info\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 360\n      },\n      __self: this\n    }, __jsx(\"h3\", {\n      className: \"\".concat(mainClass, \"-detail-info-name\"),\n      title: name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361\n      },\n      __self: this\n    }, name), __jsx(\"div\", {\n      className: \"\".concat(mainClass, \"-detail-info-disc\"),\n      title: disc,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 362\n      },\n      __self: this\n    }, disc))), __jsx(\"div\", {\n      className: \"\".concat(mainClass, \"-blur-bg\"),\n      style: blurStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365\n      },\n      __self: this\n    }), __jsx(\"div\", {\n      className: classLoading,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366\n      },\n      __self: this\n    }), __jsx(\"div\", {\n      className: \"\".concat(mainClass, \"-progress\"),\n      style: progressStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367\n      },\n      __self: this\n    }));\n  };\n\n  return __jsx(\"div\", {\n    className: classWrapper,\n    onClick: checkAudioType,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372\n    },\n    __self: this\n  }, renderCricle(), renderRect(), __jsx(\"audio\", {\n    className: \"\".concat(mainClass, \"-ele\"),\n    src: url,\n    ref: audioRef,\n    muted: muted,\n    loop: isLoop,\n    onPlay: onAudioPlay,\n    onEnded: ended,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375\n    },\n    __self: this\n  }));\n}; // export default Daudio\n// const AudioComponent = React.forwardRef(Daudio)\n// function AudioInstance(props: Exclude<IDaudioProps, 'playInfo'>) {\n//   const AudioRef = React.createRef<IDAudioRef>()\n//   const div = document.createElement('div')\n//   document.body.appendChild(div)\n//   ReactDOM.render(<AudioComponent {...props} ref={AudioRef}></AudioComponent>, div)\n//   const destroy = () => {\n//     const unmountResult = ReactDOM.unmountComponentAtNode(div)\n//     unmountResult && div.parentNode?.removeChild(div)\n//   }\n//   return {\n//     ...AudioRef.current as IDAudioRef,\n//     destroy\n//   }\n// }\n\n\nexport default Daudio;","map":{"version":3,"sources":["/Users/daiwei/pr/react-website-next/components/Audio/index.tsx"],"names":["React","useState","useRef","useImperativeHandle","useMemo","useEffect","cls","NextIcon","PauseIcon","PlayIcon","throttle","DEFAULT_PLAY_INFO","name","disc","url","coverUrl","Daudio","ref","style","type","playType","playList","playing","setPlaying","loading","setLoading","progress","setProgress","audioStyle","setAudioStyle","playTypeState","setPlayTypeState","audioTypeState","setAudioTypeState","eventQueue","playIndex","setPlayIndex","playQueue","setPlayQueue","muted","setMuted","audioRef","isHandle","currentPlayList","isLoop","checkAudioType","current","addEventListener","onAudioTimeUpdate","removeEventListener","setStyle","t","handlePlayPause","e","stopPropagation","preventDefault","pause","play","next","console","log","eventHandler","onNext","map","item","call","checkNextByList","setAudioType","playByIndex","index","l","length","load","Math","random","cut","nextAudio","Error","setPlayList","list","setPlayType","start","ended","onAudioPlay","addEvent","fn","obj","Object","assign","mainClass","classWrapper","classCricle","classPlayPause","classLoading","blurStyle","backgroundImage","backgroundSize","backgroundPosition","rangeStyle","border","progressStyle","width","currentTime","duration","renderCricle","renderRect"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useImperativeHandle, useMemo, useEffect } from 'react'\nimport cls from 'classnames'\nimport './audio.less'\nimport NextIcon from './next.svg'\nimport PauseIcon from './pause.svg'\nimport PlayIcon from './play.svg'\nimport ReactDOM from 'react-dom'\nimport {\n  throttle\n} from './utils'\n\nexport type EventType = 'onEnded' | 'onNext'\n\ntype AddEventFn = (name: EventType, cb: Function) => void\n\ntype DaudioStyle = 'rect' | 'circle'\n\ntype DaudioEventType = {\n  [props in EventType]?: Function\n}\n\ntype DaudioEventTypeQueue = {\n  [props in EventType]: Array<Function>\n} | null\n\nexport interface IDaudioPalyInfo {\n  url: string;\n  coverUrl: string;\n  name: string;\n  disc: string;\n}\n\nexport type DaudioType = 'list' | 'handle'\n\nexport type DaudioPlayType = 'sequential-play' | 'random-play' | 'loop-play'\n\nexport interface IDaudioProps {\n  style?: DaudioStyle;\n  type?: DaudioType;\n  playType?: DaudioPlayType;\n  playList?: Array<IDaudioPalyInfo>;\n  handle?: DaudioEventType;\n}\n\nexport interface IDAudioRef {\n  /**\n   * 初始化，显示audio组件\n   */\n  start: () => void;\n\n  /**\n   * 下一首\n   */\n  next: (e: Event) => void;\n  // next: (nextAudio: IDaudioPalyInfo) => void;\n  cut: (nextAudio: IDaudioPalyInfo) => void;\n\n  /**\n   * 播放\n   */\n  play: () => void;\n\n  /**\n   * 暂停\n   */\n  pause: () => void;\n\n  /**\n   * 设置audio的类型。⭕️还是方形\n   */\n  setStyle: (t: DaudioStyle) => void;\n\n  /**\n   * 设置播放形式 默认是handle\n   */\n  setAudioType: (t: DaudioType) => void;\n\n  /**\n   * 设置播放类型\n   */\n  setPlayType: (t: DaudioPlayType) => void;\n\n  /**\n   * 设置播放列表\n   */\n  setPlayList: (playlist: Array<IDaudioPalyInfo>) => void;\n\n  /**\n   * 设置事件监听\n   */\n  addEvent: AddEventFn\n}\n\nconst DEFAULT_PLAY_INFO = {\n  name: 'sunmmer',\n  disc: 'hollo sunmmer',\n  url: 'https://www.daiwei.site/static/music/background.mp3',\n  coverUrl: 'https://www.daiwei.site/static/logo/sunmmer.jpg'\n}\n\nconst Daudio: React.ForwardRefRenderFunction<IDAudioRef, IDaudioProps> = ({\n  style = 'circle',\n  type = 'handle',\n  playType = 'sequential-play',\n  playList = [DEFAULT_PLAY_INFO],\n}, ref) => {\n  const [playing, setPlaying] = useState<boolean>(false)\n  const [loading, setLoading] = useState<boolean>(false)\n  const [progress, setProgress] = useState<number>(0)\n  const [audioStyle, setAudioStyle] = useState<DaudioStyle>(style)\n  const [playTypeState, setPlayTypeState] = useState<DaudioPlayType>(playType)\n  const [audioTypeState, setAudioTypeState] = useState<DaudioType>(type)\n  const eventQueue = useRef<DaudioEventTypeQueue>(null)\n\n  const [playIndex, setPlayIndex] = useState<number>(0)\n  const [playQueue, setPlayQueue] = useState<Array<IDaudioPalyInfo>>(playList)\n\n  const [muted, setMuted] = useState<boolean>(true)\n\n  const audioRef = useRef<HTMLAudioElement>(null)\n\n  const isHandle = useMemo(() => {\n    return audioTypeState === 'handle'\n  }, [audioTypeState])\n\n  const currentPlayList = useMemo(() => {\n    return audioTypeState === 'handle' ? playQueue[0] : playQueue[playIndex]\n  }, [playIndex, playQueue[0]])\n\n  const isLoop = useMemo(() => {\n    return playTypeState === 'loop-play'\n  }, [playTypeState])\n\n  const checkAudioType = () => {\n    if (audioStyle === 'rect') {\n      setAudioStyle((audioStyle) => audioStyle = 'circle')\n    } else {\n      setAudioStyle((audioStyle) => audioStyle = 'rect')\n    }\n  }\n\n  useEffect(() => {\n    (audioRef.current  as any).addEventListener('timeupdate', onAudioTimeUpdate);\n\n    return () => {\n      (audioRef.current as any).removeEventListener('timeupdate', onAudioTimeUpdate)\n    }\n  }, [])\n\n  const setStyle = (t: DaudioStyle) => {\n    setAudioStyle(t)\n  }\n\n  const handlePlayPause = (e: any) => {\n    e.stopPropagation()\n    e.preventDefault()\n    playing ? pause() : play()\n  }\n\n  const pause = () => {\n    audioRef.current?.pause()\n    setPlaying(false)\n  }\n\n  const play = () => {\n    audioRef.current?.play()\n    setPlaying(true)\n  }\n\n  const next = (e: Event) => {\n    e.stopPropagation()\n    e.preventDefault()\n    // setHandleList(audioInfo)\n    if (isHandle) {\n      console.log('by-handle')\n      // next事件\n      const eventHandler = eventQueue.current\n      eventHandler?.onNext?.map(item => item.call(null))\n      return\n    }\n    checkNextByList()\n  }\n\n  const setAudioType = (t: DaudioType) => {\n    setAudioTypeState(t)\n  }\n\n  const playByIndex = (index: number) => {\n    setPlayIndex(index)\n    play()\n  }\n\n  /**\n   * 列表切换下一首\n   */\n  const checkNextByList = () => {\n    console.log('by-list')\n    console.log(playQueue)\n    const l = playQueue.length\n    if (l === 1) {\n      load()\n      play()\n      return\n    }\n    // 随机\n    if (playType === 'random-play') {\n      playByIndex(~~((Math.random() * playQueue.length)))\n    } else {\n      // 列表\n      console.log('playIndexplayIndex', playIndex)\n      const index = playIndex >= l - 1 ? 0 : playIndex + 1\n      playByIndex(index)\n    }\n  }\n\n  /**\n   * type 为 handle 时可调用\n   * @param nextAudio 切换下一首 \n   */\n  const cut = (nextAudio: IDaudioPalyInfo) => {\n    console.log(isHandle)\n    if (!isHandle) {\n      throw Error(`The 【cut】 method can only be executed when the type is handle`)\n    }\n    load()\n    setPlayQueue([nextAudio])\n    play()\n  }\n\n  const setPlayList = (list: Array<IDaudioPalyInfo>) => {\n    setPlayQueue(list)\n  }\n\n  const setPlayType = (t: DaudioPlayType) => {\n    setPlayTypeState(t)\n  }\n\n  const start = () => {\n  }\n\n  const ended = () => {\n    console.log(eventQueue)\n    console.log('ended')\n  }\n\n  const load = () => {\n    audioRef.current?.load()\n  }\n\n  const onAudioPlay = () => {\n    if (muted) {\n      setMuted(false)\n    }\n    // other fn\n  }\n\n  /**\n   * 添加事件\n   */\n  const addEvent = (name: EventType, fn: Function) => {\n    let obj = {} as any\n    const eventHandler = eventQueue.current\n    obj[name] = eventHandler && eventHandler[name] && eventHandler[name].length\n                  ? ([...eventHandler[name], fn]) : [fn]\n    eventQueue.current = Object.assign({}, eventHandler, obj)\n  }\n\n  const {\n    url,\n    coverUrl,\n    name,\n    disc\n  } = currentPlayList\n  console.log(currentPlayList)\n\n  const mainClass = cls({\n    [`d-audio`]: true,\n  })\n\n  const classWrapper = cls({\n    [mainClass]: true,\n    [audioStyle]: true,\n    [`show`]: true\n  })\n\n  const classCricle = cls({\n    [`d-audio-circle`]: true\n  })\n\n  const classPlayPause = cls({\n    [`d-audio-play-pause`]: true,\n    // [`play`]: playing,\n    // [`pause`]: !playing\n  })\n\n  const classLoading = cls({\n    [`d-audio-loading`]: true,\n    [`active`]: loading\n  })\n\n  const blurStyle = {\n    backgroundImage: `url(${coverUrl})`,\n    backgroundSize: 'cover',\n    backgroundPosition: 'center center'\n  }\n\n  const rangeStyle = {\n    border: `3px solid red`\n  }\n\n  const progressStyle = {\n    backgroundImage: `linear-gradient(to right, red 30%, blue)`,\n    width: `${progress}%`\n  }\n\n  const onAudioTimeUpdate = throttle((e: React.SyntheticEvent<HTMLAudioElement, Event>) => {\n    setProgress(~~((audioRef.current?.currentTime || 0) / (audioRef.current?.duration || 1) * 100))\n  }, 1000)\n\n  const renderCricle = () => {\n    return (\n      <div className={classCricle}\n           title={`${name} - ${disc}`}>\n        <img className={`${classCricle}`} crossOrigin = \"anonymous\" src={coverUrl}/>\n        <div className={`${classCricle}-range`} style={rangeStyle}></div>\n      </div>\n    )\n  }\n\n  useImperativeHandle(ref, () => ({\n    start,\n    next,\n    play,\n    pause,\n    addEvent,\n    setStyle,\n    cut,\n    setAudioType,\n    setPlayList,\n    setPlayType\n  }));\n\n  const renderRect = () => (\n    <React.Fragment>\n      <div className={`${mainClass}-detail`}>\n        <div className={`${mainClass}-detail-config`}>\n          <div className={classPlayPause} onClick={handlePlayPause}>\n            {\n              playing ? (\n                <PauseIcon></PauseIcon>\n              ) : (\n                <PlayIcon></PlayIcon>\n              )\n            }\n          </div>\n          <div className=\"d-audio-next\">\n            <NextIcon onClick={next}></NextIcon>\n          </div>\n        </div>\n        <div className={`${mainClass}-detail-info`}>\n          <h3 className={`${mainClass}-detail-info-name`} title={name}>{name}</h3>\n          <div className={`${mainClass}-detail-info-disc`} title={disc}>{disc}</div>\n        </div>\n      </div>\n      <div className={`${mainClass}-blur-bg`} style={blurStyle}></div>\n      <div className={classLoading}></div>\n      <div className={`${mainClass}-progress`} style={progressStyle}></div>\n    </React.Fragment>\n  )\n\n  return (\n    <div className={classWrapper} onClick={checkAudioType}>\n      { renderCricle() }\n      { renderRect() }\n      <audio className={`${mainClass}-ele`}\n             src={url}\n             ref={audioRef}\n             muted={muted}\n             loop={isLoop}\n             onPlay={onAudioPlay}\n             onEnded={ended}></audio>\n    </div>\n  )\n}\n\n// export default Daudio\n// const AudioComponent = React.forwardRef(Daudio)\n\n// function AudioInstance(props: Exclude<IDaudioProps, 'playInfo'>) {\n//   const AudioRef = React.createRef<IDAudioRef>()\n\n//   const div = document.createElement('div')\n//   document.body.appendChild(div)\n\n//   ReactDOM.render(<AudioComponent {...props} ref={AudioRef}></AudioComponent>, div)\n\n//   const destroy = () => {\n//     const unmountResult = ReactDOM.unmountComponentAtNode(div)\n//     unmountResult && div.parentNode?.removeChild(div)\n//   }\n\n//   return {\n//     ...AudioRef.current as IDAudioRef,\n//     destroy\n//   }\n// }\n\nexport default Daudio\n"]},"metadata":{},"sourceType":"module"}