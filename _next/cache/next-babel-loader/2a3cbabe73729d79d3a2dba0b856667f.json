{"ast":null,"code":"var _jsxFileName = \"/Users/daiwei/pr/react-website-next/components/Audio/index.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useState, useRef, useImperativeHandle, useMemo, useEffect } from 'react';\nimport cls from 'classnames';\nimport './audio.less';\nimport NextIcon from './next.svg';\nimport PauseIcon from './pause.svg';\nimport PlayIcon from './play.svg';\nimport ReactDOM from 'react-dom';\nimport { throttle } from './utils';\nconst DEFAULT_PLAY_INFO = {\n  name: 'sunmmer',\n  disc: 'hollo sunmmer',\n  url: 'https://www.daiwei.site/static/music/background.mp3',\n  coverUrl: 'https://www.daiwei.site/static/logo/sunmmer.jpg'\n};\n\nconst Daudio = ({\n  style = 'circle',\n  type = 'handle',\n  playType = 'sequential-play',\n  playList = [DEFAULT_PLAY_INFO],\n  handle\n}, ref) => {\n  const {\n    0: playing,\n    1: setPlaying\n  } = useState(false);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: progress,\n    1: setProgress\n  } = useState(0);\n  const {\n    0: audioStyle,\n    1: setAudioStyle\n  } = useState(style);\n  const {\n    0: playTypeState,\n    1: setPlayTypeState\n  } = useState(playType);\n  const {\n    0: audioTypeState,\n    1: setAudioTypeState\n  } = useState(type);\n  const eventQueue = useRef(null);\n  const {\n    0: playIndex,\n    1: setPlayIndex\n  } = useState(0);\n  const {\n    0: playQueue,\n    1: setPlayQueue\n  } = useState(playList);\n  const {\n    0: muted,\n    1: setMuted\n  } = useState(true);\n  const audioRef = useRef(null);\n  const isHandle = useMemo(() => {\n    return audioTypeState === 'handle';\n  }, [audioTypeState]);\n  const currentPlayList = useMemo(() => {\n    return audioTypeState === 'handle' ? playQueue[0] : playQueue[playIndex];\n  }, [playIndex, playQueue[0]]);\n  const isLoop = useMemo(() => {\n    return playTypeState === 'loop-play';\n  }, [playTypeState]);\n\n  const checkAudioType = () => {\n    if (audioStyle === 'rect') {\n      setAudioStyle(audioStyle => audioStyle = 'circle');\n    } else {\n      setAudioStyle(audioStyle => audioStyle = 'rect');\n    }\n  };\n\n  useEffect(() => {\n    audioRef.current.addEventListener('timeupdate', onAudioTimeUpdate);\n    handle && initHandle(handle);\n    return () => {\n      audioRef.current.removeEventListener('timeupdate', onAudioTimeUpdate);\n    };\n  }, []);\n\n  const initHandle = handle => {\n    // 注册事件\n    const handleKeys = handle && Object.keys(handle);\n    handleKeys && handleKeys.forEach(item => {\n      addEvent(item, handle && handle[item] || function () {});\n    });\n  };\n\n  const setStyle = t => {\n    setAudioStyle(t);\n  };\n\n  const handlePlayPause = e => {\n    e.stopPropagation();\n    e.preventDefault();\n    playing ? pause() : play();\n  };\n\n  const pause = () => {\n    var _audioRef$current;\n\n    (_audioRef$current = audioRef.current) === null || _audioRef$current === void 0 ? void 0 : _audioRef$current.pause();\n    setPlaying(false);\n  };\n\n  const play = () => {\n    var _audioRef$current2;\n\n    (_audioRef$current2 = audioRef.current) === null || _audioRef$current2 === void 0 ? void 0 : _audioRef$current2.play();\n    setPlaying(true);\n  };\n\n  const next = e => {\n    e.stopPropagation();\n    e.preventDefault(); // setHandleList(audioInfo)\n\n    if (isHandle) {\n      var _eventHandler$onNext;\n\n      console.log('by-handle'); // next事件\n\n      const eventHandler = eventQueue.current;\n      eventHandler === null || eventHandler === void 0 ? void 0 : (_eventHandler$onNext = eventHandler.onNext) === null || _eventHandler$onNext === void 0 ? void 0 : _eventHandler$onNext.map(item => item.call(null));\n      return;\n    }\n\n    checkNextByList();\n  };\n\n  const setAudioType = t => {\n    setAudioTypeState(t);\n  };\n\n  const playByIndex = index => {\n    setPlayIndex(index);\n    play();\n  };\n  /**\n   * 列表切换下一首\n   */\n\n\n  const checkNextByList = () => {\n    console.log('by-list');\n    console.log(playQueue);\n    const l = playQueue.length;\n\n    if (l === 1) {\n      load();\n      play();\n      return;\n    } // 随机\n\n\n    if (playType === 'random-play') {\n      playByIndex(~~(Math.random() * playQueue.length));\n    } else {\n      // 列表\n      console.log('playIndexplayIndex', playIndex);\n      const index = playIndex >= l - 1 ? 0 : playIndex + 1;\n      playByIndex(index);\n    }\n  };\n  /**\n   * type 为 handle 时可调用\n   * @param nextAudio 切换下一首 \n   */\n\n\n  const cut = nextAudio => {\n    console.log(isHandle);\n\n    if (!isHandle) {\n      throw Error(`The 【cut】 method can only be executed when the type is handle`);\n    }\n\n    load();\n    setPlayQueue([nextAudio]);\n    play();\n  };\n\n  const setPlayList = list => {\n    setPlayQueue(list);\n  };\n\n  const setPlayType = t => {\n    setPlayTypeState(t);\n  };\n\n  const start = () => {};\n\n  const ended = () => {\n    console.log(eventQueue);\n    console.log('ended');\n  };\n\n  const load = () => {\n    var _audioRef$current3;\n\n    (_audioRef$current3 = audioRef.current) === null || _audioRef$current3 === void 0 ? void 0 : _audioRef$current3.load();\n  };\n\n  const onAudioPlay = () => {\n    if (muted) {\n      setMuted(false);\n    } // other fn\n\n  };\n  /**\n   * 添加事件\n   */\n\n\n  const addEvent = (name, fn) => {\n    let obj = {};\n    const eventHandler = eventQueue.current;\n    obj[name] = eventHandler && eventHandler[name] && eventHandler[name].length ? [...eventHandler[name], fn] : [fn];\n    eventQueue.current = Object.assign({}, eventHandler, obj);\n  };\n\n  const {\n    url,\n    coverUrl,\n    name,\n    disc\n  } = currentPlayList;\n  console.log(currentPlayList);\n  const mainClass = cls({\n    [`d-audio`]: true\n  });\n  const classWrapper = cls({\n    [mainClass]: true,\n    [audioStyle]: true,\n    [`show`]: true\n  });\n  const classCricle = cls({\n    [`d-audio-circle`]: true\n  });\n  const classPlayPause = cls({\n    [`d-audio-play-pause`]: true // [`play`]: playing,\n    // [`pause`]: !playing\n\n  });\n  const classLoading = cls({\n    [`d-audio-loading`]: true,\n    [`active`]: loading\n  });\n  const blurStyle = {\n    backgroundImage: `url(${coverUrl})`,\n    backgroundSize: 'cover',\n    backgroundPosition: 'center center'\n  };\n  const rangeStyle = {\n    border: `3px solid red`\n  };\n  const progressStyle = {\n    backgroundImage: `linear-gradient(to right, red 30%, blue)`,\n    width: `${progress}%`\n  };\n  const onAudioTimeUpdate = throttle(e => {\n    var _audioRef$current4, _audioRef$current5;\n\n    setProgress(~~((((_audioRef$current4 = audioRef.current) === null || _audioRef$current4 === void 0 ? void 0 : _audioRef$current4.currentTime) || 0) / (((_audioRef$current5 = audioRef.current) === null || _audioRef$current5 === void 0 ? void 0 : _audioRef$current5.duration) || 1) * 100));\n  }, 1000);\n\n  const renderCricle = () => {\n    return __jsx(\"div\", {\n      className: classCricle,\n      title: `${name} - ${disc}`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 336\n      },\n      __self: this\n    }, __jsx(\"img\", {\n      className: `${classCricle}`,\n      crossOrigin: \"anonymous\",\n      src: coverUrl,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338\n      },\n      __self: this\n    }), __jsx(\"div\", {\n      className: `${classCricle}-range`,\n      style: rangeStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 339\n      },\n      __self: this\n    }));\n  };\n\n  useImperativeHandle(ref, () => ({\n    start,\n    next,\n    play,\n    pause,\n    addEvent,\n    setStyle,\n    cut,\n    setAudioType,\n    setPlayList,\n    setPlayType\n  }));\n\n  const renderRect = () => __jsx(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: `${mainClass}-detail`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: `${mainClass}-detail-config`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classPlayPause,\n    onClick: handlePlayPause,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361\n    },\n    __self: this\n  }, playing ? __jsx(PauseIcon, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364\n    },\n    __self: this\n  }) : __jsx(PlayIcon, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"d-audio-next\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370\n    },\n    __self: this\n  }, __jsx(NextIcon, {\n    onClick: next,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371\n    },\n    __self: this\n  }))), __jsx(\"div\", {\n    className: `${mainClass}-detail-info`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374\n    },\n    __self: this\n  }, __jsx(\"h3\", {\n    className: `${mainClass}-detail-info-name`,\n    title: name,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375\n    },\n    __self: this\n  }, name), __jsx(\"div\", {\n    className: `${mainClass}-detail-info-disc`,\n    title: disc,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376\n    },\n    __self: this\n  }, disc))), __jsx(\"div\", {\n    className: `${mainClass}-blur-bg`,\n    style: blurStyle,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: classLoading,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: `${mainClass}-progress`,\n    style: progressStyle,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381\n    },\n    __self: this\n  }));\n\n  return __jsx(\"div\", {\n    className: classWrapper,\n    onClick: checkAudioType,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386\n    },\n    __self: this\n  }, renderCricle(), renderRect(), __jsx(\"audio\", {\n    className: `${mainClass}-ele`,\n    src: url,\n    ref: audioRef,\n    muted: muted,\n    loop: isLoop,\n    onPlay: onAudioPlay,\n    onEnded: ended,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389\n    },\n    __self: this\n  }));\n}; // export default Daudio\n\n\nconst AudioComponent = React.forwardRef(Daudio);\n\nfunction AudioInstance(props) {\n  const AudioRef = React.createRef();\n  const div = document.createElement('div');\n  document.body.appendChild(div);\n  ReactDOM.createPortal(__jsx(AudioComponent, _extends({}, props, {\n    ref: AudioRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 409\n    },\n    __self: this\n  })), div);\n  console.log(AudioRef.current);\n\n  const destroy = () => {\n    var _div$parentNode;\n\n    const unmountResult = ReactDOM.unmountComponentAtNode(div);\n    unmountResult && ((_div$parentNode = div.parentNode) === null || _div$parentNode === void 0 ? void 0 : _div$parentNode.removeChild(div));\n  };\n\n  return _objectSpread({}, AudioRef.current, {\n    destroy\n  });\n}\n\nexport default AudioInstance;","map":{"version":3,"sources":["/Users/daiwei/pr/react-website-next/components/Audio/index.tsx"],"names":["React","useState","useRef","useImperativeHandle","useMemo","useEffect","cls","NextIcon","PauseIcon","PlayIcon","ReactDOM","throttle","DEFAULT_PLAY_INFO","name","disc","url","coverUrl","Daudio","style","type","playType","playList","handle","ref","playing","setPlaying","loading","setLoading","progress","setProgress","audioStyle","setAudioStyle","playTypeState","setPlayTypeState","audioTypeState","setAudioTypeState","eventQueue","playIndex","setPlayIndex","playQueue","setPlayQueue","muted","setMuted","audioRef","isHandle","currentPlayList","isLoop","checkAudioType","current","addEventListener","onAudioTimeUpdate","initHandle","removeEventListener","handleKeys","Object","keys","forEach","item","addEvent","setStyle","t","handlePlayPause","e","stopPropagation","preventDefault","pause","play","next","console","log","eventHandler","onNext","map","call","checkNextByList","setAudioType","playByIndex","index","l","length","load","Math","random","cut","nextAudio","Error","setPlayList","list","setPlayType","start","ended","onAudioPlay","fn","obj","assign","mainClass","classWrapper","classCricle","classPlayPause","classLoading","blurStyle","backgroundImage","backgroundSize","backgroundPosition","rangeStyle","border","progressStyle","width","currentTime","duration","renderCricle","renderRect","AudioComponent","forwardRef","AudioInstance","props","AudioRef","createRef","div","document","createElement","body","appendChild","createPortal","destroy","unmountResult","unmountComponentAtNode","parentNode","removeChild"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useImperativeHandle, useMemo, useEffect } from 'react'\nimport cls from 'classnames'\nimport './audio.less'\nimport NextIcon from './next.svg'\nimport PauseIcon from './pause.svg'\nimport PlayIcon from './play.svg'\nimport ReactDOM from 'react-dom'\nimport {\n  throttle\n} from './utils'\n\nexport type EventType = 'onEnded' | 'onNext'\n\ntype AddEventFn = (name: EventType, cb: Function) => void\n\ntype DaudioStyle = 'rect' | 'circle'\n\ntype DaudioEventType = {\n  [props in EventType]?: Function\n}\n\ntype DaudioEventTypeQueue = {\n  [props in EventType]: Array<Function>\n} | null\n\nexport interface IDaudioPalyInfo {\n  url: string;\n  coverUrl: string;\n  name: string;\n  disc: string;\n}\n\nexport type DaudioType = 'list' | 'handle'\n\nexport type DaudioPlayType = 'sequential-play' | 'random-play' | 'loop-play'\n\nexport interface IDaudioProps {\n  style?: DaudioStyle;\n  type?: DaudioType;\n  playType?: DaudioPlayType;\n  playList?: Array<IDaudioPalyInfo>;\n  handle?: DaudioEventType;\n}\n\nexport interface IDAudioRef {\n  /**\n   * 初始化，显示audio组件\n   */\n  start: () => void;\n\n  /**\n   * 下一首\n   */\n  next: (e: Event) => void;\n  // next: (nextAudio: IDaudioPalyInfo) => void;\n  cut: (nextAudio: IDaudioPalyInfo) => void;\n\n  /**\n   * 播放\n   */\n  play: () => void;\n\n  /**\n   * 暂停\n   */\n  pause: () => void;\n\n  /**\n   * 设置audio的类型。⭕️还是方形\n   */\n  setStyle: (t: DaudioStyle) => void;\n\n  /**\n   * 设置播放形式 默认是handle\n   */\n  setAudioType: (t: DaudioType) => void;\n\n  /**\n   * 设置播放类型\n   */\n  setPlayType: (t: DaudioPlayType) => void;\n\n  /**\n   * 设置播放列表\n   */\n  setPlayList: (playlist: Array<IDaudioPalyInfo>) => void;\n\n  /**\n   * 设置事件监听\n   */\n  addEvent: AddEventFn\n}\n\nexport interface IDAudio extends IDAudioRef {\n  destroy: () => void;\n}\n\nconst DEFAULT_PLAY_INFO = {\n  name: 'sunmmer',\n  disc: 'hollo sunmmer',\n  url: 'https://www.daiwei.site/static/music/background.mp3',\n  coverUrl: 'https://www.daiwei.site/static/logo/sunmmer.jpg'\n}\n\nconst Daudio: React.ForwardRefRenderFunction<IDAudioRef, IDaudioProps> = ({\n  style = 'circle',\n  type = 'handle',\n  playType = 'sequential-play',\n  playList = [DEFAULT_PLAY_INFO],\n  handle\n}, ref) => {\n  const [playing, setPlaying] = useState<boolean>(false)\n  const [loading, setLoading] = useState<boolean>(false)\n  const [progress, setProgress] = useState<number>(0)\n  const [audioStyle, setAudioStyle] = useState<DaudioStyle>(style)\n  const [playTypeState, setPlayTypeState] = useState<DaudioPlayType>(playType)\n  const [audioTypeState, setAudioTypeState] = useState<DaudioType>(type)\n  const eventQueue = useRef<DaudioEventTypeQueue>(null)\n\n  const [playIndex, setPlayIndex] = useState<number>(0)\n  const [playQueue, setPlayQueue] = useState<Array<IDaudioPalyInfo>>(playList)\n\n  const [muted, setMuted] = useState<boolean>(true)\n\n  const audioRef = useRef<HTMLAudioElement>(null)\n\n  const isHandle = useMemo(() => {\n    return audioTypeState === 'handle'\n  }, [audioTypeState])\n\n  const currentPlayList = useMemo(() => {\n    return audioTypeState === 'handle' ? playQueue[0] : playQueue[playIndex]\n  }, [playIndex, playQueue[0]])\n\n  const isLoop = useMemo(() => {\n    return playTypeState === 'loop-play'\n  }, [playTypeState])\n\n  const checkAudioType = () => {\n    if (audioStyle === 'rect') {\n      setAudioStyle((audioStyle) => audioStyle = 'circle')\n    } else {\n      setAudioStyle((audioStyle) => audioStyle = 'rect')\n    }\n  }\n\n  useEffect(() => {\n    (audioRef.current  as any).addEventListener('timeupdate', onAudioTimeUpdate);\n    handle && initHandle(handle)\n\n    return () => {\n      (audioRef.current as any).removeEventListener('timeupdate', onAudioTimeUpdate)\n    }\n  }, [])\n\n  const initHandle = (handle: DaudioEventType) => {\n    // 注册事件\n    const handleKeys = handle && Object.keys(handle)\n    handleKeys && (handleKeys as Array<EventType>).forEach((item) => {\n      addEvent(item, handle && handle[item] || function(){})\n    })\n  }\n\n  const setStyle = (t: DaudioStyle) => {\n    setAudioStyle(t)\n  }\n\n  const handlePlayPause = (e: any) => {\n    e.stopPropagation()\n    e.preventDefault()\n    playing ? pause() : play()\n  }\n\n  const pause = () => {\n    audioRef.current?.pause()\n    setPlaying(false)\n  }\n\n  const play = () => {\n    audioRef.current?.play()\n    setPlaying(true)\n  }\n\n  const next = (e: Event) => {\n    e.stopPropagation()\n    e.preventDefault()\n    // setHandleList(audioInfo)\n    if (isHandle) {\n      console.log('by-handle')\n      // next事件\n      const eventHandler = eventQueue.current\n      eventHandler?.onNext?.map(item => item.call(null))\n      return\n    }\n    checkNextByList()\n  }\n\n  const setAudioType = (t: DaudioType) => {\n    setAudioTypeState(t)\n  }\n\n  const playByIndex = (index: number) => {\n    setPlayIndex(index)\n    play()\n  }\n\n  /**\n   * 列表切换下一首\n   */\n  const checkNextByList = () => {\n    console.log('by-list')\n    console.log(playQueue)\n    const l = playQueue.length\n    if (l === 1) {\n      load()\n      play()\n      return\n    }\n    // 随机\n    if (playType === 'random-play') {\n      playByIndex(~~((Math.random() * playQueue.length)))\n    } else {\n      // 列表\n      console.log('playIndexplayIndex', playIndex)\n      const index = playIndex >= l - 1 ? 0 : playIndex + 1\n      playByIndex(index)\n    }\n  }\n\n  /**\n   * type 为 handle 时可调用\n   * @param nextAudio 切换下一首 \n   */\n  const cut = (nextAudio: IDaudioPalyInfo) => {\n    console.log(isHandle)\n    if (!isHandle) {\n      throw Error(`The 【cut】 method can only be executed when the type is handle`)\n    }\n    load()\n    setPlayQueue([nextAudio])\n    play()\n  }\n\n  const setPlayList = (list: Array<IDaudioPalyInfo>) => {\n    setPlayQueue(list)\n  }\n\n  const setPlayType = (t: DaudioPlayType) => {\n    setPlayTypeState(t)\n  }\n\n  const start = () => {\n  }\n\n  const ended = () => {\n    console.log(eventQueue)\n    console.log('ended')\n  }\n\n  const load = () => {\n    audioRef.current?.load()\n  }\n\n  const onAudioPlay = () => {\n    if (muted) {\n      setMuted(false)\n    }\n    // other fn\n  }\n\n  /**\n   * 添加事件\n   */\n  const addEvent = (name: EventType, fn: Function) => {\n    let obj = {} as any\n    const eventHandler = eventQueue.current\n    obj[name] = eventHandler && eventHandler[name] && eventHandler[name].length\n                  ? ([...eventHandler[name], fn]) : [fn]\n    eventQueue.current = Object.assign({}, eventHandler, obj)\n  }\n\n  const {\n    url,\n    coverUrl,\n    name,\n    disc\n  } = currentPlayList\n  console.log(currentPlayList)\n\n  const mainClass = cls({\n    [`d-audio`]: true,\n  })\n\n  const classWrapper = cls({\n    [mainClass]: true,\n    [audioStyle]: true,\n    [`show`]: true\n  })\n\n  const classCricle = cls({\n    [`d-audio-circle`]: true\n  })\n\n  const classPlayPause = cls({\n    [`d-audio-play-pause`]: true,\n    // [`play`]: playing,\n    // [`pause`]: !playing\n  })\n\n  const classLoading = cls({\n    [`d-audio-loading`]: true,\n    [`active`]: loading\n  })\n\n  const blurStyle = {\n    backgroundImage: `url(${coverUrl})`,\n    backgroundSize: 'cover',\n    backgroundPosition: 'center center'\n  }\n\n  const rangeStyle = {\n    border: `3px solid red`\n  }\n\n  const progressStyle = {\n    backgroundImage: `linear-gradient(to right, red 30%, blue)`,\n    width: `${progress}%`\n  }\n\n  const onAudioTimeUpdate = throttle((e: React.SyntheticEvent<HTMLAudioElement, Event>) => {\n    setProgress(~~((audioRef.current?.currentTime || 0) / (audioRef.current?.duration || 1) * 100))\n  }, 1000)\n\n  const renderCricle = () => {\n    return (\n      <div className={classCricle}\n           title={`${name} - ${disc}`}>\n        <img className={`${classCricle}`} crossOrigin = \"anonymous\" src={coverUrl}/>\n        <div className={`${classCricle}-range`} style={rangeStyle}></div>\n      </div>\n    )\n  }\n\n  useImperativeHandle(ref, () => ({\n    start,\n    next,\n    play,\n    pause,\n    addEvent,\n    setStyle,\n    cut,\n    setAudioType,\n    setPlayList,\n    setPlayType\n  }));\n\n  const renderRect = () => (\n    <React.Fragment>\n      <div className={`${mainClass}-detail`}>\n        <div className={`${mainClass}-detail-config`}>\n          <div className={classPlayPause} onClick={handlePlayPause}>\n            {\n              playing ? (\n                <PauseIcon></PauseIcon>\n              ) : (\n                <PlayIcon></PlayIcon>\n              )\n            }\n          </div>\n          <div className=\"d-audio-next\">\n            <NextIcon onClick={next}></NextIcon>\n          </div>\n        </div>\n        <div className={`${mainClass}-detail-info`}>\n          <h3 className={`${mainClass}-detail-info-name`} title={name}>{name}</h3>\n          <div className={`${mainClass}-detail-info-disc`} title={disc}>{disc}</div>\n        </div>\n      </div>\n      <div className={`${mainClass}-blur-bg`} style={blurStyle}></div>\n      <div className={classLoading}></div>\n      <div className={`${mainClass}-progress`} style={progressStyle}></div>\n    </React.Fragment>\n  )\n\n  return (\n    <div className={classWrapper} onClick={checkAudioType}>\n      { renderCricle() }\n      { renderRect() }\n      <audio className={`${mainClass}-ele`}\n             src={url}\n             ref={audioRef}\n             muted={muted}\n             loop={isLoop}\n             onPlay={onAudioPlay}\n             onEnded={ended}></audio>\n    </div>\n  )\n}\n\n// export default Daudio\nconst AudioComponent = React.forwardRef(Daudio)\n\nfunction AudioInstance(props: Exclude<IDaudioProps, 'playInfo'>): IDAudio {\n  const AudioRef = React.createRef<IDAudioRef>()\n\n  const div = document.createElement('div')\n  document.body.appendChild(div)\n\n  ReactDOM.createPortal(<AudioComponent {...props} ref={AudioRef}></AudioComponent>, div)\n\n  console.log(AudioRef.current)\n  \n  const destroy = () => {\n    const unmountResult = ReactDOM.unmountComponentAtNode(div)\n    unmountResult && div.parentNode?.removeChild(div)\n  }\n\n  return {\n    ...AudioRef.current as IDAudioRef,\n    destroy\n  }\n}\n\nexport default AudioInstance\n"]},"metadata":{},"sourceType":"module"}